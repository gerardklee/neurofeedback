<!DOCTYPE HTML>
<html>
    <head>
        <title>Neurofeedback</title>
    </head>
    <p>Bar Chart</p>
    <body>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.4/socket.io.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3"></script>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://d3js.org/d3-random.v2.min.js"></script>
        <script src="/Users/gerardlee/Desktop/git/neurofeedback/node_modules/rickshaw/rickshaw.min.js"></script>
        <canvas id="barChart"></canvas>
        <script>
            console.log("bar chart");
            var socket = io('http://localhost:3000');
            var ctx = document.getElementById('barChart').getContext('2d');

            // bar chart
            var barChartData = {
                labels: ['Alpha Waves'],
                datasets: [
                    {
                        label: '7Hz',
                        backgroundColor: '#AF7', // lime green
                        borderWidth: 5,
                        data: [1]
                    },                        {
                        label: '7.25Hz',
                        backgroundColor: '#AF7',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '7.5Hz',
                        backgroundColor: '#AF7',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '7.75Hz',
                        backgroundColor: '#AF7',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '8Hz',
                        backgroundColor: '#9400D3', // purple
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '8.25Hz',
                        backgroundColor: '#9400D3',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '8.5Hz',
                        backgroundColor: '#9400D3',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '8.75Hz',
                        backgroundColor: '#9400D3',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '9Hz',
                        backgroundColor: '#00FFFF', // sky blue
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '9.25Hz',
                        backgroundColor: '#00FFFF',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '9.5Hz',
                        backgroundColor: '#00FFFF',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '9.75Hz',
                        backgroundColor: '#00FFFF',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '10Hz',
                        backgroundColor: '#0000A0', // blue
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '10.25Hz',
                        backgroundColor: '#0000A0',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '10.5Hz',
                        backgroundColor: '#0000A0',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '10.75Hz',
                        backgroundColor: '#0000A0',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '11Hz',
                        backgroundColor: '#FFFF00', // yellow
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '11.25Hz',
                        backgroundColor: '#FFFF00',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '11.5Hz',
                        backgroundColor: '#FFFF00',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '11.75Hz',
                        backgroundColor: '#FFFF00',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '12Hz',
                        backgroundColor: '#008000', // green
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '12.25Hz',
                        backgroundColor: '#008000', 
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '12.5Hz',
                        backgroundColor: '#008000',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '12.75Hz',
                        backgroundColor: '#008000',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '13Hz',
                        backgroundColor: '#FFA500', // orange
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '13.25Hz',
                        backgroundColor: '#FFA500', 
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '13.5Hz',
                        backgroundColor: '#FFA500',
                        borderWidth: 5,
                        data: [1]
                    },
                    {
                        label: '13.75Hz',
                        backgroundColor: '#FFA500',
                        borderWidth: 5,
                        data: [1]
                    }
                ]
            };

            var barChart = new Chart(ctx, {
                type: 'bar',
                data: barChartData,
                options: {
                    title: {
                        display: false,
                        text: "Bar Chart",
                        fontSize: 14,
                        fontFamily: 'Arial',
                        fontColor: '#FF0000'
                    },

                    legend: {
                        display: false
                    }
                }
            });

            socket.on('fft_data', function(fft_data) {
                //console.log("start updating bar chart");
                //updateBarChart(barChart, fft_data);
            });  

        </script>
        <p>Line Chart</p>
        <script>                     
            var n      = 40,
                random = d3.randomNormal(5, 10),
                //data   = d3.range(n).map(random);
                data = [16, 17, 18, 19, 20, 16.5, 17.5, 18, 19, 18.5];
            
            console.log(data);
            var step = 10;

            var margin = {top: 50, right: 50, bottom: 50, left: 50},
                globalX = 0,
                width = 960 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

            var xScale = d3.scaleLinear()
                    .domain([0, n - 1]) // input should be between minimum value to maximum value in dataset
                    .range([0, width]); // when the input is the max value from the data, it outputs width

            var yScale = d3.scaleLinear()
                    .domain([d3.min(data), d3.max(data)])
                    .range([height, 0]);

            var line = d3.line()
                    .x(function(d, i) { return xScale(i); })
                    .y(function(d, i) { return yScale(d); })
                    .curve(d3.curveMonotoneX);

            var canvas = d3.select("body").append("svg")
                                        .attr("width", width + margin.left + margin.right)
                                        .attr("height", height + margin.top + margin.bottom)
                                        .append("g")
                                        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");                      
             
            // set the canvas to draw
            canvas.append("defs").append("clipPath")
                                .attr("id", "clip")
                                .append("rect")
                                .attr("width", width)
                                .attr("height", height);
            
            // manipulate x-axis
            canvas.append("g")
                  .attr("class", "x axis")
                  .attr("transform", "translate(0, " + height + ")")
                  .call(d3.axisBottom(xScale)); // create axis on the bottom given the scale for x-axis

            // manipulate y-axis
            canvas.append("g")
                  .attr("class", "y axis")
                  .call(d3.axisLeft(yScale)); // create axis on the left given the scale for y-axis

            // path is filled by default. set the fill to none and stroke to black to get rid of fill.
            var path = canvas.append("g")
                            .append("path")
                            .attr("fill", "none")
                            .attr("stroke", "black")
                            .data([data]);
                            
            socket.on('fft_data', function(fft_data) {
                updateLineChart(fft_data);
            });  

            // FUNCTIONS FOR BAR CHART
            function updateBarChart(barChart, fft_data) {
                for (var i = 0; i < barChart.data.datasets.length; i++) {
                    barChart.data.datasets[i].data.pop();
                    barChart.data.datasets[i].data.push(fft_data.psd[0][i]);
                }
                barChart.update();
            }

            // FUNCTIONS FOR LINE CHART
            function updateLineChart(fft_data) {
                var averageAlpha = getAlphaAverage(fft_data.psd[0]);
                data.push(averageAlpha);
                path.attr("d", line)
                    .attr("transform", null)
                    .transition()
                    .duration(100)
                    .ease(d3.easeLinear)
                    .attr("transform", "translate(" + xScale(-1) + ",0)")
                data.shift();
            }

            function getAlphaAverage(fft_data) {
                var total = 0;
                var average = 0;
                var totalNumberofFrequencies = 7
                for (var i = 0; i < fft_data.length; i++) {
                    total += fft_data[i];
                }
                average = total / totalNumberofFrequencies;
                return average;
            }
        </script>  
    </body>   
</html>